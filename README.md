# Quadcopter Drone Flight Controller

## Overview

This repository contains the source code for a quadcopter drone flight controller developed in C++ on an STM32H7 microcontroller. Various sensors and control algorithms are used to achieve stable and responsive flight.

## Features

- **Microcontroller**: STM32H7 running at 480 MHz
- **IMU Sensor**: ICM20948  (3-axis accelerometer, 3-axis gyroscope, and 3-axis magnetometer)
- **Radio Receiver**: Reading Sbus signals
- **ESC Control**: Generating 500Hz PWM signals for brushless motors' ESCs
- **AHRS (Attitude Estimation)**: Madgwick filter
- **Quaternion Calculations**: To avoid gimbal lock and enable efficient spherical rotation interpolation
- **PID Controllers**: For various flight modes including stabilized, acrobatic, and GPS position mode


## Quaternions

Quaternion is use through the entire control loop.
Quaternions avoid singularities (like gimbal lock) that can occur with Euler angles, making them a robust choice for representing 3D rotations, especially in drones that can maneuver aggressively.


## AHRS (Attitude and Heading Reference System)

The AHRS fuses data from the accelerometer, gyroscope, and magnetometer using a Maggwick filter to estimate the attitude of the quadcopter.

## PID Control

The project utilizes chained PID controllers to manage motor power in different flight modes.

- **Stabilized Mode**:
  - **Cascaded PIDs for Attitude Control**:
    - The attitude error is processed by a PID controller to produce an angular rate target. This target is then used as the input for another PID controller, which compute the torque vector.

- **Acrobatic Mode**:
  - The angular rate error is processed by a PID controller to directly compute the torque vector.


## Mixer


## Finite State Machines


## Hardware

- **Frame**: The frame is 3D printed using PLA, which offers significant rigidity. This rigidity is particularly beneficial in dampening low-frequency vibrations generated by the motors, allowing only high-frequency vibrations to pass through. The electronic components, including a highly sensitive accelerometer, are mounted using silent blocks. These silent blocks are effective in reducing high-frequency vibrations, ensuring that the accelerometer and other electronics remain stable and less affected by vibrations.

![PLA Frame](pictures/frame.jpg)

- **PCB**: A custom PCB board is made to best fit in the chassis. The IMU is solder on this PCB that plugged as a shield on the microcontroller development board.

![Electronics](pictures/electronics.jpg)